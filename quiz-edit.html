<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–†–µ–¥–∞–∫—Ç–æ—Ä ‚Äî –ü–∞—Ä—è—â–∏–π –∫–≤–∏–∑ (–ö–ì–ë)</title>
<style>
  :root{ --ui:#ffd700; --card:#151515; --ink:#eee; --muted:#b7b7b7; --stroke:#2a2a2a; --gap:16px; }
  *{box-sizing:border-box} html,body{height:100%}
  body{ margin:0; background:#0d0d0d; color:var(--ink); font-family:Rubik,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; display:flex; flex-direction:column;}
  header{ display:flex; align-items:center; gap:12px; padding:16px 20px; border-bottom:1px solid var(--stroke); position:sticky; top:0; background:#0d0d0d; z-index:2;}
  header h1{margin:0; font-size:20px; color:var(--ui); font-weight:800}
  main{ display:grid; grid-template-columns: 430px 1fr; gap:22px; padding:20px; max-width:1500px; width:100%; margin:0 auto}
  .card{ background:var(--card); border:1px solid var(--stroke); border-radius:14px; padding:18px; box-shadow:0 0 28px rgba(255,215,0,.06);}
  .card h2{ margin:0 0 14px; font-size:18px; color:var(--ui)}
  label{ display:block; margin:12px 0 8px; font-size:15px; color:#fff; font-weight:600}
  input[type="text"], input[type="number"], textarea{ width:100%; background:#101010; color:#fff; border:1px solid #3a3a3a; border-radius:10px; padding:12px 14px; font-size:16px; outline:none; }
  textarea{ min-height:110px; resize:vertical}
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:var(--gap)}
  .toolbar{ display:flex; gap:12px; flex-wrap:wrap}
  .levels .level{ background:#111; border:1px solid #2a2a2a; border-radius:12px; padding:16px}
  .level h3{ margin:0 0 10px; font-size:16px; color:#fff; display:flex; align-items:center; justify-content:space-between}
  .right{ display:flex; gap:10px; align-items:center}
  .hint{ color:var(--muted); font-size:13px; margin-top:8px}
  .pill{ display:inline-block; padding:8px 12px; border:1px dashed #444; border-radius:999px; color:#bbb; font-size:13px}
  button{ background:linear-gradient(90deg,#ffbf00,#ffd700); color:#000; border:none; border-radius:12px; font-weight:800; padding:14px 18px; cursor:pointer; font-size:16px;}
  button:hover{ transform:translateY(-1px); box-shadow:0 8px 26px rgba(255,215,0,.28)}
  .btn-ghost{ background:transparent; color:#fff; border:1px solid #444}
  .btn-danger{ background:#a80000; color:#fff}
  .result{ display:grid; grid-template-columns:1fr auto; gap:12px; align-items:start}
  .result textarea{ height:120px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
</style>
</head>
<body>
<header><h1>–†–µ–¥–∞–∫—Ç–æ—Ä ¬´–ü–∞—Ä—è—â–∏–π –∫–≤–∏–∑¬ª ‚Äî –ö–ì–ë</h1></header>

<main>
  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <section class="card">
    <h2>‚öôÔ∏è –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <div class="row">
      <div>
        <label>–í–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å (2‚Äì10)</label>
        <input type="number" id="answersPerQuestion" value="4" min="2" max="10">
      </div>
      <div>
        <label>–°–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è (px/–∫–∞–¥—Ä)</label>
        <input type="number" id="speedFall" value="2.2" step="0.1" min="0.5" max="10">
      </div>
    </div>
    <div class="row">
      <div>
        <label>–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–ø–∞–≤–Ω–∞ (–º—Å)</label>
        <input type="number" id="spawnInterval" value="900" min="200" step="50">
      </div>
      <div>
        <label>–ì–ª–æ–±–∞–ª—å–Ω—ã–µ ¬´–æ—Ç–≤–ª–µ–∫–∞—é—â–∏–µ¬ª (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ, –º–æ–∂–Ω–æ URL)</label>
        <textarea id="globalWrong" placeholder="dog\napple\nhttps://.../wrong.gif"></textarea>
      </div>
    </div>
  </section>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <section class="card">
    <h2>üéØ –í–æ–ø—Ä–æ—Å—ã</h2>
    <div id="levels" class="levels"></div>
    <div class="toolbar">
      <button id="addQ">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
      <span class="pill">–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤</span>
    </div>

    <h2 style="margin-top:8px">üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è</h2>
    <div class="row">
      <button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å iframe</button>
      <button id="testBtn" class="btn-ghost">üîç –í–∞–ª–∏–¥–∞—Ü–∏—è JSON</button>
    </div>

    <div class="result" style="margin-top:10px">
      <textarea id="iframeOut" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è iframe –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏"></textarea>
      <button id="copyBtn" class="btn-ghost">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
    <div class="hint">–ó–∞–≥—Ä—É–∑–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π JSON –≤ –ø–∞–ø–∫—É <code>/data</code> —Å–≤–æ–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è ‚Üí Commit.</div>
  </section>
</main>

<footer style="padding:14px 20px; color:#888; border-top:1px solid var(--stroke); text-align:center">¬© 2025 –ö–ì–ë</footer>

<script>
const $=s=>document.querySelector(s); const $$=s=>document.querySelectorAll(s);

// –ê–≤—Ç–æ–±–∞–∑–∞ –¥–æ quiz-main.html –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ
const BASE_MAIN = (function(){
  const dir = location.origin + location.pathname.replace(/[^\/]+$/,'');
  return dir + 'quiz-main.html';
})();

// ‚Äî –≤–æ–ø—Ä–æ—Å—ã ‚Äî
function qTemplate(idx){
  const wrap=document.createElement('div'); wrap.className='level';
  wrap.innerHTML=`
    <h3>–í–æ–ø—Ä–æ—Å <span class="num">${idx+1}</span>
      <span class="right">
        <button type="button" class="btn-ghost up">‚ñ≤</button>
        <button type="button" class="btn-ghost down">‚ñº</button>
        <button type="button" class="btn-danger del">–£–¥–∞–ª–∏—Ç—å</button>
      </span>
    </h3>
    <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–≤–≤–µ—Ä—Ö—É)</label>
    <input type="text" class="question" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?">
    <div class="row">
      <div>
        <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (—Ç–µ–∫—Å—Ç –∏–ª–∏ URL)</label>
        <input type="text" class="correct" placeholder="–ü–∞—Ä–∏–∂ –∏–ª–∏ https://.../cat.gif">
      </div>
      <div>
        <label>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (–ø–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ)</label>
        <textarea class="wrong" placeholder="–ú–∞—Ä—Å–µ–ª—å\n–õ–∏–æ–Ω\n–ù–∏—Ü—Ü–∞"></textarea>
      </div>
    </div>
  `;
  wrap.querySelector('.del').onclick=()=>{wrap.remove(); renumber();};
  wrap.querySelector('.up').onclick =()=>{const p=wrap.previousElementSibling; if(p){wrap.parentNode.insertBefore(wrap,p); renumber();}};
  wrap.querySelector('.down').onclick=()=>{const n=wrap.nextElementSibling; if(n){wrap.parentNode.insertBefore(n,wrap); renumber();}};
  return wrap;
}
function addQ(){ const idx=$$('#levels .level').length; $('#levels').appendChild(qTemplate(idx)); renumber(); }
function renumber(){ $$('#levels .level .num').forEach((n,i)=>n.textContent=i+1); }

function collect(){
  const questions=[];
  $$('#levels .level').forEach(div=>{
    questions.push({
      question: div.querySelector('.question').value.trim(),
      correct:  div.querySelector('.correct').value.trim(),
      wrong:    div.querySelector('.wrong').value.split('\n').map(s=>s.trim()).filter(Boolean)
    });
  });
  const cfg={
    answersPerQuestion: Math.max(2, Math.min(10, parseInt($('#answersPerQuestion').value||'4',10))),
    speedFall: parseFloat($('#speedFall').value||'2.2'),
    spawnInterval: Math.max(200, parseInt($('#spawnInterval').value||'900',10)),
    globalWrong: $('#globalWrong').value.split('\n').map(s=>s.trim()).filter(Boolean),
    questions
  };
  return cfg;
}

function validate(cfg){
  if(!cfg.questions.length) return '–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å.';
  for(const [i,q] of cfg.questions.entries()){
    if(!q.question) return `–í–æ–ø—Ä–æ—Å ${i+1}: –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞.`;
    if(!q.correct)  return `–í–æ–ø—Ä–æ—Å ${i+1}: —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.`;
    if((q.wrong?.length||0) + 1 < 2) return `–í–æ–ø—Ä–æ—Å ${i+1}: –Ω—É–∂–µ–Ω –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—á—Ç–æ–±—ã –±—ã–ª–æ ‚â•2 –≤–∞—Ä–∏–∞–Ω—Ç–∞).`;
  }
  return null;
}

function makeId(cfg){
  const first=(cfg.questions[0]?.question||'quiz').trim();
  const slug=first.toLowerCase()
    .normalize('NFKD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').slice(0,40)||'quiz';
  const d=new Date(),p=n=>String(n).padStart(2,'0');
  const stamp=`${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(d.getHours())}${p(d.getMinutes())}${p(d.getSeconds())}`;
  return `${slug}-${stamp}`;
}

async function publish(){
  const cfg=collect();
  const err=validate(cfg); if(err){ alert(err); return; }

  const id=makeId(cfg);
  const jsonStr=JSON.stringify(cfg,null,2);

  // –°–ö–ê–ß–ê–¢–¨ <id>.json
  const blob=new Blob([jsonStr],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=id+'.json';
  document.body.appendChild(a); a.click(); a.remove();

  // iframe –ø–æ–¥ —Ç–≤–æ—ë —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ
  const iframe=`<iframe src="${BASE_MAIN}?id=${encodeURIComponent(id)}" width="900" height="640" style="border:0;" allow="autoplay" allowfullscreen></iframe>`;
  $('#iframeOut').value=iframe;

  alert('JSON —Å–æ—Ö—Ä–∞–Ω—ë–Ω –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É /data –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (Add file ‚Üí Upload files ‚Üí Commit).');
}

function quickTest(){
  const cfg=collect(); const err=validate(cfg); if(err){ alert(err); return; }
  alert('JSON –≤–∞–ª–∏–¥–µ–Ω. –í–æ–ø—Ä–æ—Å–æ–≤: '+cfg.questions.length);
  console.log(cfg);
}

function copyIframe(){
  const v=$('#iframeOut').value.trim(); if(!v){ alert('–°–Ω–∞—á–∞–ª–∞ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å iframe.'); return; }
  navigator.clipboard.writeText(v).then(()=>{}).catch(()=>{});
}

// init
$('#addQ').addEventListener('click', e=>{ e.preventDefault(); addQ(); });
$('#saveBtn').addEventListener('click', publish);
$('#testBtn').addEventListener('click', quickTest);
$('#copyBtn').addEventListener('click', copyIframe);
addQ();
</script>
</body>
</html>
